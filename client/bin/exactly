#!/usr/bin/python3
"""Binary exact search 

Usage:
  exactly [options] index <root>
  exactly [options] search

Options:
  -h --help   Show this screen.
  --version   Show version.
  --debug-log <log-file> Debug logging to file exactly.log in current directory
  --debug <debug-string> Start PyDev debug server. Debug string format: host:port:pydev_src
"""
from docopt import docopt
import subprocess
import sys
from exactly import console
from exactly import set_debug, set_debug_logging

def get_version():
    try:
        with open("/opt/exactly/lib/python/VERSION", "r") as f:
            return f.read()
    except:
        return "UNKNOWN"


def index(root_folder):
    p = subprocess.Popen(['java', '-jar', '/opt/exactly/lib/java/exactly-server.jar', '--dir=' + root_folder])
    return p.wait()

    
def search():
    return console.ExactlyConsole.main()

    
if __name__ == '__main__':
    args = docopt(__doc__, version=get_version())
    set_debug_logging(args['--debug-log'])
    set_debug(args['--debug'])
    if args['index']:
        sys.exit(index(args['<root>']))
    elif args['search']:
        sys.exit(search())
